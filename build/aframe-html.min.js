!function(e){"use strict";class t extends e.Mesh{constructor(t){const i=new n(t),o=new e.PlaneGeometry(.001*i.image.width,.001*i.image.height),s=new e.MeshBasicMaterial({map:i,toneMapped:!1,transparent:!0});function r(e){s.map.dispatchDOMEvent(e)}super(o,s),this.addEventListener("mousedown",r),this.addEventListener("mousemove",r),this.addEventListener("mouseup",r),this.addEventListener("click",r),this.dispose=function(){o.dispose(),s.dispose(),s.map.dispose(),this.removeEventListener("mousedown",r),this.removeEventListener("mousemove",r),this.removeEventListener("mouseup",r),this.removeEventListener("click",r)}}}class n extends e.CanvasTexture{constructor(t){super(o(t)),this.dom=t,this.anisotropy=16,this.encoding=e.sRGBEncoding,this.minFilter=e.LinearFilter,this.magFilter=e.LinearFilter;const n=new MutationObserver((()=>{this.scheduleUpdate||(this.scheduleUpdate=setTimeout((()=>this.update()),16))}));n.observe(t,{attributes:!0,childList:!0,subtree:!0,characterData:!0}),this.observer=n}dispatchDOMEvent(e){e.data&&function(e,t,n,i){const o={clientX:n*e.offsetWidth+e.offsetLeft,clientY:i*e.offsetHeight+e.offsetTop,view:e.ownerDocument.defaultView};window.dispatchEvent(new MouseEvent(t,o));const s=e.getBoundingClientRect();function r(e){if(e.nodeType!==Node.TEXT_NODE&&e.nodeType!==Node.COMMENT_NODE){const s=e.getBoundingClientRect();n>s.left&&n<s.right&&i>s.top&&i<s.bottom&&e.dispatchEvent(new MouseEvent(t,o));for(let t=0;t<e.childNodes.length;t++)r(e.childNodes[t])}}n=n*s.width+s.left,i=i*s.height+s.top,r(e)}(this.dom,e.type,e.data.x,e.data.y)}update(){this.image=o(this.dom),this.needsUpdate=!0,this.scheduleUpdate=null}dispose(){this.observer&&this.observer.disconnect(),this.scheduleUpdate=clearTimeout(this.scheduleUpdate),super.dispose()}}const i=new WeakMap;function o(t){const n=document.createRange(),o=new e.Color;function s(e,t,n,i){""!==i&&("uppercase"===e.textTransform&&(i=i.toUpperCase()),h.font=e.fontWeight+" "+e.fontSize+" "+e.fontFamily,h.textBaseline="top",h.fillStyle=e.color,h.fillText(i,t,n+.1*parseFloat(e.fontSize)))}function r(e,t,n,i,o){n<2*o&&(o=n/2),i<2*o&&(o=i/2),h.beginPath(),h.moveTo(e+o,t),h.arcTo(e+n,t,e+n,t+i,o),h.arcTo(e+n,t+i,e,t+i,o),h.arcTo(e,t+i,e,t,o),h.arcTo(e,t,e+n,t,o),h.closePath()}function l(e,t,n,i,o,s){const r=e[t+"Width"],l=e[t+"Style"],a=e[t+"Color"];"0px"!==r&&"none"!==l&&"transparent"!==a&&"rgba(0, 0, 0, 0)"!==a&&(h.strokeStyle=a,h.lineWidth=parseFloat(r),h.beginPath(),h.moveTo(n,i),h.lineTo(n+o,i+s),h.stroke())}const a=t.getBoundingClientRect();let d;i.has(t)?d=i.get(t):(d=document.createElement("canvas"),d.width=a.width,d.height=a.height);const h=d.getContext("2d"),c=new function(e){const t=[];let n=!1;function i(){if(n&&(n=!1,e.restore()),0===t.length)return;let i=-1/0,o=-1/0,s=1/0,r=1/0;for(let e=0;e<t.length;e++){const n=t[e];i=Math.max(i,n.x),o=Math.max(o,n.y),s=Math.min(s,n.x+n.width),r=Math.min(r,n.y+n.height)}e.save(),e.beginPath(),e.rect(i,o,s-i,r-o),e.clip(),n=!0}return{add:function(e){t.push(e),i()},remove:function(){t.pop(),i()}}}(h);return function e(t,i){let d=0,p=0,f=0,u=0;if(t.nodeType===Node.TEXT_NODE){n.selectNode(t);const e=n.getBoundingClientRect();d=e.left-a.left-.5,p=e.top-a.top-.5,f=e.width,u=e.height,s(i,d,p,t.nodeValue.trim())}else{if(t.nodeType===Node.COMMENT_NODE)return;if(t instanceof HTMLCanvasElement){if("none"===t.style.display)return;h.save();const e=window.devicePixelRatio;h.scale(1/e,1/e),h.drawImage(t,0,0),h.restore()}else{if("none"===t.style.display)return;const e=t.getBoundingClientRect();d=e.left-a.left-.5,p=e.top-a.top-.5,f=e.width,u=e.height;const n=(i=window.getComputedStyle(t)).backgroundColor;r(d,p,f,u,parseFloat(i.borderRadius)),"transparent"!==n&&"rgba(0, 0, 0, 0)"!==n&&(h.fillStyle=n,h.fill());const m=["borderTop","borderLeft","borderBottom","borderRight"];let v=!0,E=null;for(const e of m){if(E&&(v=i[e+"Width"]===i[E+"Width"]&&i[e+"Color"]===i[E+"Color"]&&i[e+"Style"]===i[E+"Style"]),!v)break;E=e}if(v){const e=parseFloat(i.borderTopWidth);"0px"!==i.borderTopWidth&&"none"!==i.borderTopStyle&&"transparent"!==i.borderTopColor&&"rgba(0, 0, 0, 0)"!==i.borderTopColor&&(h.strokeStyle=i.borderTopColor,h.lineWidth=e,h.stroke())}else l(i,"borderTop",d,p,f,0),l(i,"borderLeft",d,p,0,u),l(i,"borderBottom",d,p+u,f,0),l(i,"borderRight",d+f,p,0,u);if(t instanceof HTMLInputElement){let e=i.accentColor;void 0!==e&&"auto"!==e||(e=i.color),o.set(e);const n=Math.sqrt(.299*o.r**2+.587*o.g**2+.114*o.b**2)<.5?"white":"#111111";if("radio"===t.type&&(r(d,p,f,u,u),h.fillStyle="white",h.strokeStyle=e,h.lineWidth=1,h.fill(),h.stroke(),t.checked)){const t=2;r(d+t,p+t,f-2*t,u-2*t,u),h.fillStyle=e,h.strokeStyle=n,h.lineWidth=t,h.fill(),h.stroke()}if("checkbox"===t.type&&(r(d,p,f,u,2),h.fillStyle=t.checked?e:"white",h.strokeStyle=t.checked?n:e,h.lineWidth=1,h.stroke(),h.fill(),t.checked)){const e=h.textAlign;h.textAlign="center",s({color:n,fontFamily:i.fontFamily,fontSize:u+"px",fontWeight:"bold"},d+f/2,p,"âœ”"),h.textAlign=e}if("range"===t.type){const[i,o,s]=["min","max","value"].map((e=>parseFloat(t[e]))),l=(s-i)/(o-i)*(f-u);r(d,p+.25*u,f,.5*u,.25*u),h.fillStyle=n,h.strokeStyle=e,h.lineWidth=1,h.fill(),h.stroke(),r(d,p+.25*u,l+.5*u,.5*u,.25*u),h.fillStyle=e,h.fill(),r(d+l,p,u,u,.5*u),h.fillStyle=e,h.fill()}"color"!==t.type&&"text"!==t.type&&"number"!==t.type||(c.add({x:d,y:p,width:f,height:u}),s(i,d+parseInt(i.paddingLeft),p+parseInt(i.paddingTop),t.value),c.remove())}}}const m="auto"===i.overflow||"hidden"===i.overflow;m&&c.add({x:d,y:p,width:f,height:u});for(let n=0;n<t.childNodes.length;n++)e(t.childNodes[n],i);m&&c.remove()}(t),d}const s={type:"",data:new THREE.Vector2};AFRAME.registerComponent("html-pointer",{schema:{activationType:{oneOf:["event","proximity"],default:"event"},downEvents:{type:"array",default:["selectstart"]},upEvents:{type:"array",default:["selectend"]},clickEvents:{type:"array",default:["select"]}},init(){this.htmlEl=null,this.onDown=e=>this.handle("mousedown",e),this.onUp=e=>this.handle("mouseup",e),this.onClick=e=>this.handle("click",e),this.onIntersection=e=>this.htmlEl=e.detail.els[0],this.onIntersectionCleared=e=>this.htmlEl=null,this.el.addEventListener("raycaster-intersection",this.onIntersection),this.el.addEventListener("raycaster-intersection-cleared",this.onIntersectionCleared)},handle(e,t){if(this.htmlEl){const t=this.el.components.raycaster.getIntersection(this.htmlEl);if(t){const n=this.htmlEl.getObject3D("html"),i=t.uv;s.type=e,s.data.set(i.x,1-i.y),n.dispatchEvent(s)}}},update(e={}){if(e.downEvents)for(const t of e.downEvents)this.el.removeEventListener(t,this.onDown);if(e.upEvents)for(const t of e.upEvents)this.el.removeEventListener(t,this.onUp);if(e.clickEvents)for(const t of e.clickEvents)this.el.removeEventListener(t,this.onClick);if("event"===this.data.activationType){for(const e of this.data.downEvents)this.el.addEventListener(e,this.onDown);for(const e of this.data.upEvents)this.el.addEventListener(e,this.onUp);for(const e of this.data.clickEvents)this.el.addEventListener(e,this.onClick)}},remove(){this.el.removeEventListener("raycaster-intersection",this.onIntersection),this.el.removeEventListener("raycaster-intersection-cleared",this.onIntersectionCleared)}}),AFRAME.registerComponent("html",{schema:{type:"selector"},init(){this.rerender=this.rerender.bind(this)},update(){if(this.remove(),!this.data)return;const e=new t(this.data);this.el.setObject3D("html",e),this.data.addEventListener("input",this.rerender)},rerender(){const e=this.el.getObject3D("html");e&&!e.material.map.scheduleUpdate&&(e.material.map.scheduleUpdate=setTimeout((()=>e.material.map.update()),16))},remove(){this.el.getObject3D("html")&&(this.el.removeObject3D("html"),this.data.removeEventListener("change",this.rerender))}})}(THREE);
//# sourceMappingURL=aframe-html.min.js.map
